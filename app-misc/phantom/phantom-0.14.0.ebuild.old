# Copyright 1999-2013 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: $

EAPI=4

DESCRIPTION="I/O engine with some modules"
HOMEPAGE="https://github.com/yandex-load/phantom"
GIT_SHA1="d3a656b"
SRC_URI="https://github.com/yandex-load/phantom/tarball/${GIT_SHA1} -> ${P}.tar.gz"

LICENSE="GPL-2"
SLOT="0"
KEYWORDS="~amd64"
IUSE=""

DEPEND=""
RDEPEND="${DEPEND}"

S="${WORKDIR}/yandex-load-${PN}-${GIT_SHA1}"

src_compile() {
	emake -R || die "Make failed!"
}

src_install() {
	dobin ${S}/bin/phantom
	dolib.a ${S}/lib/libpd-base.a
	dolib.a ${S}/lib/libpd-base.s.a
	dolib.a ${S}/lib/libpd-bq.a
	dolib.a ${S}/lib/libpd-bq.s.a
	dolib.a ${S}/lib/libpd-debug.a
	dolib.a ${S}/lib/libpd-debug.s.a
	dolib.a ${S}/lib/libpd-http.a
	dolib.a ${S}/lib/libpd-http.s.a
	dolib.a ${S}/lib/libpd-ssl.a
	dolib.a ${S}/lib/libpd-ssl.s.a
	dodir /usr/lib/phantom
	into /usr/lib/phantom
	dolib.so ${S}/lib/phantom/mod_debug.so
	dolib.so ${S}/lib/phantom/mod_io_benchmark_method_stream_ipv4.so
	dolib.so ${S}/lib/phantom/mod_io_benchmark_method_stream_ipv6.so
	dolib.so ${S}/lib/phantom/mod_io_benchmark_method_stream_local.so
	dolib.so ${S}/lib/phantom/mod_io_benchmark_method_stream_proto_http.so
	dolib.so ${S}/lib/phantom/mod_io_benchmark_method_stream_proto_none.so
	dolib.so ${S}/lib/phantom/mod_io_benchmark_method_stream.so
	dolib.so ${S}/lib/phantom/mod_io_benchmark_method_stream_source_log.so
	dolib.so ${S}/lib/phantom/mod_io_benchmark_method_stream_source_random.so
	dolib.so ${S}/lib/phantom/mod_io_benchmark_method_stream_transport_ssl.so
	dolib.so ${S}/lib/phantom/mod_io_benchmark.so
	dolib.so ${S}/lib/phantom/mod_io_client_ipv4.so
	dolib.so ${S}/lib/phantom/mod_io_client_ipv6.so
	dolib.so ${S}/lib/phantom/mod_io_client_local.so
	dolib.so ${S}/lib/phantom/mod_io_client_proto_fcgi.so
	dolib.so ${S}/lib/phantom/mod_io_client_proto_none.so
	dolib.so ${S}/lib/phantom/mod_io_client.so
	dolib.so ${S}/lib/phantom/mod_io_stream_ipv4.so
	dolib.so ${S}/lib/phantom/mod_io_stream_ipv6.so
	dolib.so ${S}/lib/phantom/mod_io_stream_proto_echo.so
	dolib.so ${S}/lib/phantom/mod_io_stream_proto_http_handler_fcgi.so
	dolib.so ${S}/lib/phantom/mod_io_stream_proto_http_handler_null.so
	dolib.so ${S}/lib/phantom/mod_io_stream_proto_http_handler_proxy.so
	dolib.so ${S}/lib/phantom/mod_io_stream_proto_http_handler_static.so
	dolib.so ${S}/lib/phantom/mod_io_stream_proto_http.so
	dolib.so ${S}/lib/phantom/mod_io_stream_proto_monitor.so
	dolib.so ${S}/lib/phantom/mod_io_stream.so
	dolib.so ${S}/lib/phantom/mod_io_stream_transport_ssl.so
	dolib.so ${S}/lib/phantom/mod_ssl.so
	dodoc COPYING
	dodoc README.ru
	dodoc AUTHORS
}
